{% extends 'shop/base.html' %}
{% load static %}

{% block title %}Мои заказы{% endblock %}

{% block content %}
<main class="content">
  <section class="section container section-blue">
    <header class="section__header header-center">
      <h1 class="section__title h2">Мои заказы</h1>
    </header>
    <div class="section__body">
      <div class="orders">
        {% if orders %}
          {% for order in orders %}
            <div class="order">
              <div class="order__info-card">
                <div><strong>ID:</strong> {{ order.id }}</div>
                <div><strong>Дата:</strong> {{ order.created_at|date:"d.m.Y H:i" }}</div>
                <div><strong>Адрес:</strong> {{ order.address|default:"—" }}</div>
                <div><strong>Доставка:</strong> {{ order.get_delivery_type_display }}</div>
                <div><strong>Итого:</strong> {{ order.total }} ₽</div>
                <div><strong>Статус:</strong> {{ order.get_status_display }}</div>
              </div>

              <div class="order__info-content">
                  <div class="order__info-products">
                    <table>
                      <thead>
                        <tr><th>Название</th><th>Кол-во</th><th>Стоимость</th></tr>
                      </thead>
                      <tbody>
                        {% for item in order.items.all %}
                          <tr>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.price }} ₽</td>
                          </tr>
                        {% empty %}
                          <tr><td colspan="3">Нет товаров</td></tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
    
                  <div class="order__interactive">
                    {% if order.status != 'completed' and order.status != 'cancelled' %}
                      <form method="post" action="{% url 'shop:order_cancel' order.id %}">
                        {% csrf_token %}
                        <button class="button button-delete" type="submit">Отменить</button>
                      </form>
                    {% endif %}
                  </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p>У вас пока нет заказов.</p>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}
